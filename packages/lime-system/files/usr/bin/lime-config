#!/usr/bin/lua

local libuci = require "uci"
fs  = require "nixio.fs"
iw  = require "iwinfo"

firewall = require "lime.firewall"
network = require "lime.network"
wireless = require "lime.wireless"
system = require "lime.system"
config = require "lime.config"
utils = require "lime.utils"

uci = libuci:cursor()

--@DEPRECATED avoid use this function and/or put it in the right place!!
function node_id()
    local m = network.primary_mac()
    return tonumber(m[4], 16), tonumber(m[5], 16), tonumber(m[6], 16)
end

--@DEPRECATED avoid use this function and/or put it in the right place!!
function network_id()
    local network_essid = assert(config.get("wifi","ap_essid"))
    local n1, n2, n3
    local fd = io.popen('echo "' .. network_essid .. '" | md5sum')
    if fd then
        local md5 = fd:read("*a")
        n1 = tonumber(md5:match("^(..)"), 16)
        n2 = tonumber(md5:match("^..(..)"), 16)
        n3 = tonumber(md5:match("^....(..)"), 16)
        fd:close()
    end
    return n1, n2, n3
end

function main()
	network.configure()
	wireless.configure()
	firewall.configure()
	system.configure()
end

main()
