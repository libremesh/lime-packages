#!/usr/bin/lua
--! SPDX-License-Identifier: AGPL-3.0-or-later
--!
--! LibreMesh
--! Copyright (C) 2019  Gioacchino Mazzurco <gio@altermundi.net>

local JSON = require("luci.jsonc")
local location = require("lime.location")

local hostname = io.input("/proc/sys/kernel/hostname"):read("*line")
local result = { [hostname] = location.nodes_and_links() }
io.popen("shared-state insert nodes_and_links", "w"):write(JSON.stringify(result))

