#!/bin/sh /etc/rc.common
# Copyright (C) 2019 Ilario Gelmetti <ilario@sindominio.net>
USE_PROCD=1
START=45
STOP=01
BACKUPDIR=/etc/tests-scheduler
BACKUPFILE=$BACKUPDIR/tests-scheduler-probe-data-persist
FRESHFILE=/tmp/tests-scheduler-probe-data
CONFIGURATION=tests-scheduler

start_service() {
	config_load "${CONFIGURATION}"
	local persist_to_flash
	config_get persist_to_flash probe persist_to_flash
	procd_open_instance
	procd_set_param respawn
	procd_set_param command [[ $persist_to_flash == "true" ]] && [[ -e $BACKUPFILE ]] && cp $BACKUPFILE $FRESHFILE
	procd_set_param file /etc/config/tests-scheduler
	procd_set_param stdout 1
	procd_set_param stderr 1
	procd_close_instance
}

stop_service() {
	[[ $persist_to_flash == "true" ]] && [[ -e $FRESHFILE ]] && [[ -d $BACKUPDIR ]] && cp $FRESHFILE $BACKUPFILE
}
