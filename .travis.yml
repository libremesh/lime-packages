sudo: false
dist: trusty
addons:
  apt:
    sources:
    - sourceline: 'ppa:ubuntu-toolchain-r/test'
    packages:
    - build-essential
    - subversion
    - libncurses5-dev
    - zlib1g-dev
    - gawk
    - gcc-multilib
    - flex
    - git-core
    - gettext
    - libssl-dev
    - libstdc++6-4.7-dev
notifications:
  email: false
language: c
install:
- cd $TRAVIS_BUILD_DIR
- git clone https://github.com/libremesh/lime-sdk.git sdk || true
- cd sdk
- sed 's|https://github.com/libremesh/lime-packages.git.*|'$TRAVIS_BUILD_DIR'|g' feeds.conf.default > feeds.conf.default.local
- ./cooker -f -d x86/generic
script:
- cd $TRAVIS_BUILD_DIR/sdk
- export J=$(($(nproc)+1))
- ./cooker -b x86/generic
- ./cooker --flavor=lime_default -c x86/generic --profile=Generic
- ./cooker --flavor=lime_mini -c x86/generic --profile=Generic
- ./cooker --flavor=lime_zero -c x86/generic --profile=Generic
after_success:
- openssl aes-256-cbc -K $encrypted_4ddb7c1a1584_key -iv $encrypted_4ddb7c1a1584_iv -in $TRAVIS_BUILD_DIR/.ci/travisci_rsa.enc -out $TRAVIS_BUILD_DIR/.ci/travisci_rsa -d
- chmod 400 $TRAVIS_BUILD_DIR/.ci/travisci_rsa
- mv $TRAVIS_BUILD_DIR/sdk/output $TRAVIS_BUILD_DIR/sdk/$TRAVIS_PULL_REQUEST
- rsync -r -v -e "ssh -i $TRAVIS_BUILD_DIR/.ci/travisci_rsa -o UserKnownHostsFile=$TRAVIS_BUILD_DIR/.ci/known_hosts" $TRAVIS_BUILD_DIR/sdk/$TRAVIS_PULL_REQUEST ci@repo.libremesh.org:/var/www/ci/
